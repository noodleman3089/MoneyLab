import express, { Request, Response } from 'express';
import { query } from '../index';

const router = express.Router();

/**
 * üìã GET /api/lookups
 * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Lookup ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (occupations, income_periods)
 * ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á authenticate ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ
 */
router.get('/', async (req: Request, res: Response) => {
  try {
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const occupations = await query(
      'SELECT occupation_id, occupation_name FROM occupation ORDER BY occupation_id',
      []
    );

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const incomePeriods = await query(
      'SELECT period_id, name_th, code FROM income_period ORDER BY period_id',
      []
    );

    res.json({
      status: true,
      data: {
        occupations,
        income_periods: incomePeriods
      }
    });
  } catch (error: any) {
    console.error('Error fetching lookups:', error);
    res.status(500).json({
      status: false,
      message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
      error: error.message
    });
  }
});

export default router;
